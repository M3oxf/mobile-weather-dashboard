<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Mobile Weather Dashboard</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b5e9b">
<style>
  :root{
    --bg:#0b5e9b; --bg2:#0a4e82; --card:#f4f5f7; --text:#0b1220; --muted:#6b7280;
    --accent:#1976d2; --line:#e5e7eb; --shadow:0 1px 2px rgba(0,0,0,.08), 0 6px 16px rgba(0,0,0,.06);
    --radius:14px; --barh:58px;
  }
  [data-theme="dark"]{
    --bg:#0b1b2b; --bg2:#091522; --card:#111827; --text:#e5e7eb; --muted:#9ca3af;
    --accent:#60a5fa; --line:#263141; --shadow:0 1px 2px rgba(0,0,0,.4), 0 6px 16px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background:#fff; color:var(--text);
    padding-bottom: calc(var(--barh) + env(safe-area-inset-bottom,0px));
    transition: background .15s ease, color .15s ease;
  }
  [data-theme="dark"] body, [data-theme="dark"]{ background:#0b0f19; }
  .topbar{ position:sticky; top:0; background: linear-gradient(180deg,var(--bg),var(--bg2));
    padding:10px 12px calc(10px + env(safe-area-inset-top,0px)); z-index:10; color:#fff; }
  .search-row{ display:flex; gap:8px; align-items:center; }
  .search{ flex:1; display:flex; gap:6px; align-items:center; background:#fff;
    border-radius:999px; padding:8px 10px; box-shadow: var(--shadow); }
  .search input{ border:0; outline:0; font-size:16px; flex:1; min-width:60px; }
  .icon-btn{ border:0; background:#fff; border-radius:999px; width:40px; height:40px;
    display:grid; place-items:center; box-shadow:var(--shadow); cursor:pointer; }
  .icon-link{ text-decoration:none }
  .unit-row{ margin-top:8px; display:flex; gap:8px; align-items:center; justify-content:space-between; }
  .seg{ background:rgba(255,255,255,.18); border-radius:999px; padding:3px; display:inline-flex; gap:3px; }
  .seg button{ border:0; padding:6px 10px; border-radius:999px; color:#fff; background:transparent;
    font-weight:700; cursor:pointer; }
  .seg button.active{ background:#fff; color:#0b5e9b; }
  [data-theme="dark"] .seg{ background:rgba(255,255,255,.12); }
  [data-theme="dark"] .seg button.active{ color:#0b1b2b; }
  .days{ display:flex; gap:8px; overflow:auto; padding:10px 12px; border-bottom:1px solid var(--line);
    scroll-snap-type:x mandatory; background:transparent; }
  .chip{ scroll-snap-align:start; padding:8px 12px; border-radius:999px; border:1px solid var(--line);
    background:#fff; color:#111827; white-space:nowrap; font-weight:700; cursor:pointer; flex:0 0 auto; }
  .chip.active{ background:var(--accent); color:#fff; border-color:transparent; }
  [data-theme="dark"] .chip{ background:#0f172a; color:#e5e7eb; }
  .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(120px,1fr));
    gap:10px; padding:10px 12px 16px; max-width:900px; margin:0 auto; }
  .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); min-height:118px;
    padding:10px 12px; position:relative; overflow:hidden; display:flex; flex-direction:column; justify-content:space-between; }
  .value{ font-size:20px; font-weight:800; letter-spacing:.2px; }
  .label{ font-size:12px; color:var(--muted); font-weight:700; }
  .sub{ font-size:12px; color:var(--muted); }
  .big{ font-size:22px; }
  .row{ display:flex; align-items:center; gap:8px; }
  .weather-icon{ width:26px; height:26px; opacity:.9 }
  .compass{ --size:88px; width:var(--size); height:var(--size); border-radius:50%; border:2px solid #d1d5db;
    position:relative; margin:2px auto 8px; display:grid; place-items:center; background:#fff; }
  [data-theme="dark"] .compass{ background:#0f172a; border-color:#374151; }
  .compass .needle{ width:2px; height:36px; background:#ef4444; position:absolute; top:calc(50% - 36px);
    transform-origin:bottom center; border-radius:2px; }
  .compass .cap{ width:10px; height:10px; background:#111827; border-radius:50%; position:absolute; }
  [data-theme="dark"] .compass .cap{ background:#e5e7eb; }
  .compass .cardinal{ position:absolute; font-size:10px; color:#6b7280; font-weight:800; }
  .compass .N{ top:4px; left:50%; transform:translateX(-50%); }
  .compass .S{ bottom:4px; left:50%; transform:translateX(-50%); }
  .compass .E{ right:6px; top:50%; transform:translateY(-50%); }
  .compass .W{ left:6px; top:50%; transform:translateY(-50%); }
  .timebar{ position:fixed; bottom:0; left:0; right:0; height:var(--barh); background:#fff; border-top:1px solid var(--line);
    display:flex; gap:6px; overflow-x:auto; padding:8px 10px; z-index:20; padding-bottom: calc(8px + env(safe-area-inset-bottom,0px)); }
  [data-theme="dark"] .timebar{ background:#0b0f19; }
  .time{ padding:8px 10px; border:1px solid var(--line); border-radius:10px; font-weight:800; font-size:13px;
    color:#374151; background:#fff; cursor:pointer; flex:0 0 auto; min-width:42px; text-align:center; user-select:none; }
  .time.active{ background:var(--accent); color:#fff; border-color:transparent; }
  [data-theme="dark"] .time{ background:#111827; color:#e5e7eb; }
  @media (max-width: 430px){
    :root{ --barh:108px; }
    .timebar{ display:grid; grid-template-columns: repeat(12, 1fr); grid-auto-rows: 1fr; overflow-x:hidden; height:var(--barh); }
    .time{ min-width:0; padding:8px 6px; }
  }
  .note{ text-align:center; color:#6b7280; font-size:12px; margin:8px 12px 80px }
  .toast{ position:fixed; left:50%; bottom:calc(var(--barh) + 16px); transform:translateX(-50%);
    background:#111827; color:#fff; padding:8px 12px; border-radius:12px; font-size:13px; box-shadow:var(--shadow);
    opacity:0; pointer-events:none; transition:opacity .25s ease; }
  .toast.show{ opacity:1 }
  .svg{ width:22px; height:22px }
</style>
</head>
<body>

  <!-- Top bar -->
  <div class="topbar">
    <div class="search-row">
      <div class="search">
        <svg class="svg" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
          <circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input id="q" list="place-list" placeholder="Search locationâ€¦" autocomplete="off">
        <datalist id="place-list"></datalist>
      </div>
      <button id="go" class="icon-btn" title="Search">
        <svg class="svg" viewBox="0 0 24 24" fill="none" stroke="#0b5e9b" stroke-width="2">
          <polyline points="22 2 11 13 9 15 9 9 3 3"/>
        </svg>
      </button>
      <button id="gps" class="icon-btn" title="Use GPS">
        <svg class="svg" viewBox="0 0 24 24" fill="none" stroke="#0b5e9b" stroke-width="2">
          <circle cx="12" cy="12" r="3"/><path d="M19.4 15A8 8 0 1 1 15 4.6"/>
        </svg>
      </button>
      <a id="windyBtn" class="icon-btn icon-link" title="Wind Map (Windy)" target="_blank" rel="noopener">
        <svg class="svg" viewBox="0 0 24 24" fill="none" stroke="#0b5e9b" stroke-width="2">
          <path d="M3 12c2-3 6-3 8 0s6 3 8 0"/><path d="M4 16c1.5-2 4.5-2 6 0s4.5 2 6 0"/>
        </svg>
      </a>
    </div>

    <div class="unit-row">
      <div id="loc" style="font-weight:800">â€”</div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="seg" id="speedSeg">
          <button data-speed="kph" class="active">km/h</button><button data-speed="mph">mph</button>
        </div>
        <div class="seg" id="tempSeg">
          <button data-temp="c" class="active">Â°C</button><button data-temp="f">Â°F</button>
        </div>
        <div class="seg" id="themeSeg" title="Theme">
          <button data-theme="light">â˜€ï¸Ž</button><button data-theme="dark">ðŸŒ™</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Day selector -->
  <div class="days" id="days"></div>

  <!-- Cards -->
  <div class="grid" id="grid">
    <div class="card" id="c-weather">
      <div class="row">
        <svg class="weather-icon" id="weatherIcon" viewBox="0 0 24 24"></svg>
        <div class="sub" id="weatherDesc">â€”</div>
      </div>
      <div class="value big" id="temp">â€”</div>
      <div class="label">Weather</div>
    </div>

    <div class="card">
      <div class="value" id="clouds">â€”</div>
      <div class="label">Cloud cover</div>
    </div>

    <div class="card">
      <div class="value" id="visibility">â€”</div>
      <div class="label">Visibility</div>
    </div>

    <div class="card">
      <div class="value" id="wind">â€”</div>
      <div class="label">Wind</div>
    </div>

    <div class="card">
      <div class="value" id="gust">â€”</div>
      <div class="label">Gust (hour)</div>
    </div>

    <div class="card">
      <div class="compass">
        <div class="needle" id="needle" style="transform:rotate(0deg)"></div>
        <div class="cap"></div>
        <div class="cardinal N">N</div><div class="cardinal E">E</div>
        <div class="cardinal S">S</div><div class="cardinal W">W</div>
      </div>
      <div class="sub" id="windDirTxt" style="text-align:center">â€”</div>
      <div class="label">Wind direction</div>
    </div>

    <div class="card">
      <div class="value" id="precip">â€”</div>
      <div class="label">Precipitation</div>
    </div>

    <div class="card">
      <div class="value" id="pop">â€”</div>
      <div class="label">Precip probability</div>
    </div>

    <div class="card">
      <div class="value" id="feels">â€”</div>
      <div class="label">Feels like</div>
    </div>

    <div class="card">
      <div class="value" id="humidity">â€”</div>
      <div class="label">Humidity</div>
    </div>

    <div class="card">
      <div class="sub">Sunrise / Sunset</div>
      <div class="value" id="sunTimes">â€”</div>
      <div class="label">Sun</div>
    </div>

    <div class="card">
      <div class="value" id="uv">â€”</div>
      <div class="label">UV index</div>
    </div>

    <div class="card">
      <div class="value" id="pressure">â€”</div>
      <div class="label">Pressure</div>
    </div>
  </div>

  <div class="note">Data: Open-Meteo â€¢ No API key needed.</div>

  <!-- Bottom hour selector -->
  <div id="timebar" class="timebar" aria-label="Select hour"></div>
  <div id="toast" class="toast"></div>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const daysEl = $("#days"), timebar = $("#timebar"), toast = $("#toast"), grid = $("#grid");
  const LS_KEYS = { place:"mw_place", units:"mw_units", theme:"mw_theme", day:"mw_day", hour:"mw_hour" };

  const state = {
    units: { speed: "kph", temp: "c" },
    theme: (localStorage.getItem(LS_KEYS.theme)||"light"),
    place: { name: "United Kingdom", lat: 51.5, lon: -0.1 },
    data: null,
    dayIndex: 0,
    hourIndex: new Date().getHours()
  };

  // Load saved settings
  try{
    const u = JSON.parse(localStorage.getItem(LS_KEYS.units)||"null"); if(u) state.units=u;
    const p = JSON.parse(localStorage.getItem(LS_KEYS.place)||"null"); if(p) state.place=p;
    const di = parseInt(localStorage.getItem(LS_KEYS.day)); if(Number.isFinite(di)) state.dayIndex=di;
    const hi = parseInt(localStorage.getItem(LS_KEYS.hour)); if(Number.isFinite(hi)) state.hourIndex=hi;
  }catch{}

  document.documentElement.setAttribute("data-theme", state.theme);
  [...document.querySelectorAll('#themeSeg button')].forEach(b=>{ if(b.dataset.theme===state.theme) b.classList.add('active'); });
  // Apply current unit buttons
  [...document.querySelectorAll('#speedSeg button')].forEach(b=>{ if(b.dataset.speed===state.units.speed) b.classList.add('active'); });
  [...document.querySelectorAll('#tempSeg button')].forEach(b=>{ if(b.dataset.temp===state.units.temp) b.classList.add('active'); });

  // Unit toggles
  document.querySelectorAll('#speedSeg button').forEach(b=>{
    b.onclick = ()=>{
      document.querySelectorAll('#speedSeg button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); state.units.speed = b.dataset.speed; saveUnits(); render();
    };
  });
  document.querySelectorAll('#tempSeg button').forEach(b=>{
    b.onclick = ()=>{
      document.querySelectorAll('#tempSeg button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); state.units.temp = b.dataset.temp; saveUnits(); render();
    };
  });

  // Theme toggle
  document.querySelectorAll('#themeSeg button').forEach(b=>{
    b.onclick = ()=>{
      document.querySelectorAll('#themeSeg button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); state.theme = b.dataset.theme;
      document.documentElement.setAttribute("data-theme", state.theme);
      localStorage.setItem(LS_KEYS.theme, state.theme);
    };
  });

  // Search & GPS
  $("#go").onclick = ()=> searchAndLoad($("#q").value.trim());
  $("#q").addEventListener('keydown', e=>{
    if(e.key === 'Enter') $("#go").click();
    if($("#q").value.length >= 2) suggest($("#q").value.trim());
  });
  $("#gps").onclick = ()=>{
    if(!navigator.geolocation){ note("Geolocation not available."); return; }
    navigator.geolocation.getCurrentPosition(async pos=>{
      const {latitude:lat, longitude:lon} = pos.coords;
      const name = await reverseLookup(lat, lon).catch(()=>null);
      setPlace({name: name||"Current location", lat, lon});
      load();
    }, _err=> note("Location permission denied."));
  };

  function setPlace(p){
    state.place = p; $("#loc").textContent = p.name; updateWindyLink();
    localStorage.setItem(LS_KEYS.place, JSON.stringify(p));
  }
  function saveUnits(){ localStorage.setItem(LS_KEYS.units, JSON.stringify(state.units)); }
  function saveDayHour(){
    localStorage.setItem(LS_KEYS.day, String(state.dayIndex));
    localStorage.setItem(LS_KEYS.hour, String(state.hourIndex));
  }

  function note(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1600); }
  function updateWindyLink(){
    const z=8, {lat,lon}=state.place;
    $("#windyBtn").href = `https://www.windy.com/?${lat.toFixed(3)},${lon.toFixed(3)},${z}`;
  }

  async function suggest(q){
    try{
      const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=5&language=en&format=json`;
      const r = await fetch(url); const j = await r.json();
      const dl = $("#place-list"); dl.innerHTML="";
      (j.results||[]).forEach(p=>{
        const opt = document.createElement('option');
        opt.value = `${p.name}, ${p.country}`; opt.dataset.lat = p.latitude; opt.dataset.lon = p.longitude;
        dl.appendChild(opt);
      });
    }catch{}
  }
  async function reverseLookup(lat, lon){
    const url = `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=en&format=json`;
    const r = await fetch(url); const j = await r.json();
    const p = (j.results||[])[0]; return p ? `${p.name}, ${p.country}` : null;
  }
  async function searchAndLoad(q){
    if(!q){ note("Type a place."); return; }
    const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=1&language=en&format=json`;
    try{
      const r = await fetch(url); const j = await r.json();
      if(!j.results || !j.results.length){ note("No match."); return; }
      const p = j.results[0];
      setPlace({name:`${p.name}, ${p.country}`, lat:p.latitude, lon:p.longitude});
      load();
    }catch{ note("Search failed."); }
  }

  function buildWeatherURL(lat, lon){
    const hourly = [
      "temperature_2m","apparent_temperature","relative_humidity_2m",
      "cloud_cover","visibility","wind_speed_10m","wind_gusts_10m",
      "wind_direction_10m","uv_index","surface_pressure","precipitation_probability"
    ].join(",");
    const daily = ["weathercode","uv_index_max","precipitation_sum","sunrise","sunset"].join(",");
    return `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`
      + `&hourly=${hourly}&daily=${daily}&timezone=auto`;
  }

  async function load(){
    const url = buildWeatherURL(state.place.lat, state.place.lon);
    try{
      const r = await fetch(url); state.data = await r.json();
      buildDays();
      // Clamp restored day/hour to available range
      state.dayIndex = Math.max(0, Math.min(state.dayIndex, state.data.daily.time.length-1));
      state.hourIndex = Math.max(0, Math.min(state.hourIndex, 23));
      buildHourBar(); render();
    }catch{ note("Network error."); }
  }

  function buildDays(){
    daysEl.innerHTML=""; const times = state.data.daily.time; const todayStr = new Date().toDateString();
    times.forEach((t, i)=>{
      const d = new Date(t);
      const label = (d.toDateString() === todayStr) ? "Today" : d.toLocaleDateString(undefined,{weekday:"short"});
      const btn = document.createElement("button");
      btn.className = "chip" + (i===state.dayIndex ? " active":""); btn.textContent = label;
      btn.onclick = ()=> selectDay(i); daysEl.appendChild(btn);
    });
  }
  function selectDay(i){
    [...daysEl.children].forEach(x=>x.classList.remove("active")); daysEl.children[i].classList.add("active");
    state.dayIndex = i; if(i!==0) state.hourIndex = 12; buildHourBar(); render(); saveDayHour();
  }

  function buildHourBar(){
    timebar.innerHTML="";
    for(let h=0; h<24; h++){
      const b = document.createElement("button");
      b.className = "time" + (h===state.hourIndex ? " active":""); b.textContent = String(h).padStart(2,"0");
      // haptics + long-press
      let longTimer=null, pressed=false;
      const vibrate = (ms)=>{ try{ if('vibrate' in navigator) navigator.vibrate(ms); }catch{} };
      b.addEventListener('click', ()=>{
        if(!pressed){ // if it wasn't a long-press
          selectHour(h); vibrate(10);
        }
        pressed=false;
      });
      b.addEventListener('pointerdown', ()=>{ pressed=false; longTimer=setTimeout(()=>{ pressed=true; jumpToNow(); vibrate(30); }, 550); });
      const clearLP = ()=>{ if(longTimer){ clearTimeout(longTimer); longTimer=null; } };
      b.addEventListener('pointerup', clearLP); b.addEventListener('pointercancel', clearLP); b.addEventListener('pointerleave', clearLP);

      timebar.appendChild(b);
    }
    const active = timebar.querySelector(".time.active");
    if(active && timebar.scrollWidth > timebar.clientWidth){ active.scrollIntoView({inline:"center"}); }
  }
  function selectHour(h){
    [...timebar.children].forEach(x=>x.classList.remove("active"));
    timebar.children[h].classList.add("active"); state.hourIndex = h; render(); saveDayHour();
  }
  function jumpToNow(){ if(state.dayIndex!==0){ selectDay(0); } selectHour(new Date().getHours()); }

  function hourBaseIndexForDay(i){
    const d = state.data; const midnight = new Date(d.daily.time[i] + "T00:00:00");
    const idx = d.hourly.time.findIndex(t => new Date(t).getTime() === midnight.getTime());
    return (idx >= 0) ? idx : i*24;
  }

  function render(){
    if(!state.data) return;
    const d = state.data, day = state.dayIndex, base = hourBaseIndexForDay(day);
    const H = Math.min(base + state.hourIndex, d.hourly.time.length-1);

    const kph = v => v, mph = v => v * 0.621371, toSpeed = v => (state.units.speed === "mph" ? mph(v) : kph(v));
    const fmt = (v, n=0) => (v==null || Number.isNaN(v)) ? "â€”" : Number(v).toFixed(n);
    const c2f = c => (c*9/5)+32, toTemp = c => (state.units.temp === "f" ? c2f(c) : c);
    const km = v => v/1000;

    const wcode = d.daily.weathercode[day];
    $("#weatherDesc").textContent = weatherDesc(wcode);
    $("#weatherIcon").innerHTML = weatherSVG(wcode);
    $("#temp").textContent = fmt(toTemp(d.hourly.temperature_2m[H]),0) + "Â°";
    $("#clouds").textContent = fmt(d.hourly.cloud_cover[H],0) + "%";

    const visKm = km(d.hourly.visibility[H]);
    $("#visibility").textContent = (visKm >= 10 ? "10+ km" : fmt(visKm,0) + " km");

    $("#wind").textContent = fmt(toSpeed(d.hourly.wind_speed_10m[H]),0) + " " + (state.units.speed==="mph"?"mph":"km/h");
    $("#gust").textContent = fmt(toSpeed(d.hourly.wind_gusts_10m[H]),0) + " " + (state.units.speed==="mph"?"mph":"km/h");

    const deg = d.hourly.wind_direction_10m[H];
    $("#needle").style.transform = `rotate(${deg}deg)`;
    $("#windDirTxt").textContent = `${deg!=null?Math.round(deg):"â€”"}Â° ${bearing(deg)}`;

    $("#precip").textContent = fmt(d.daily.precipitation_sum[day],1) + " mm";
    const pp = d.hourly.precipitation_probability?.[H];
    $("#pop").textContent = (pp==null? "â€”" : Math.round(pp) + "%");

    $("#feels").textContent = fmt(toTemp(d.hourly.apparent_temperature[H]),0) + "Â°";
    $("#humidity").textContent = fmt(d.hourly.relative_humidity_2m[H],0) + "%";
    const sr = new Date(d.daily.sunrise[day]); const ss = new Date(d.daily.sunset[day]);
    $("#sunTimes").textContent = timeStr(sr) + "  /  " + timeStr(ss);
    $("#uv").textContent = fmt(d.daily.uv_index_max[day],0);
    $("#pressure").textContent = fmt(d.hourly.surface_pressure[H],0) + " hPa";
  }

  function timeStr(dt){ return dt.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"}); }
  function bearing(deg){ if(deg==null) return ""; const dirs = ["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];
    const ix = Math.round(((deg%360)+360)%360 / 22.5) % 16; return dirs[ix]; }
  function weatherDesc(code){
    const map = {0:"Clear",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Depositing rime fog",
      51:"Drizzle light",53:"Drizzle",55:"Drizzle heavy",61:"Rain light",63:"Rain",65:"Rain heavy",
      71:"Snow light",73:"Snow",75:"Snow heavy",80:"Rain showers",81:"Rain showers",82:"Violent showers",
      95:"Thunderstorm",96:"Thunderstorm hail",99:"Thunderstorm heavy hail"}; return map[code] ?? "â€”";
  }

  // Swipe left/right on grid to change day
  (function enableSwipe(){
    let startX=0, startY=0, swiping=false;
    grid.addEventListener('touchstart', (e)=>{ const t=e.touches[0]; startX=t.clientX; startY=t.clientY; swiping=true; }, {passive:true});
    grid.addEventListener('touchmove', (e)=>{ if(!swiping) return; }, {passive:true});
    grid.addEventListener('touchend', (e)=>{
      if(!swiping) return; swiping=false;
      const t=e.changedTouches[0]; const dx=t.clientX - startX; const dy=t.clientY - startY;
      if(Math.abs(dx)>50 && Math.abs(dx)>Math.abs(dy)){
        if(dx<0 && state.dayIndex < state.data.daily.time.length-1){ selectDay(state.dayIndex+1); }
        else if(dx>0 && state.dayIndex>0){ selectDay(state.dayIndex-1); }
      }
    }, {passive:true});
  })();

  // Kick off
  setPlace(state.place); updateWindyLink(); load();

  // Register Service Worker (only works on https/localhost)
  if('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost')){
    navigator.serviceWorker.register('./sw.js').catch(()=>{ /* ignore */ });
  }
})();
</script>
</body>
</html>
